{% extends 'frontend/sidebar-h-screen.html' %}

{% block title %} Task List {% endblock %}

{% block content %}
   


        <section class="text-gray-600 body-font">
            <div class="container px-5 py-2 mx-auto">
                
                <div class="pb-10">
                    <h1 class="text-2xl">Project: {{ project.name }}</h1>
                </div>

                <!-- <header class="text-gray-600 body-font ">
                    <div class="container mx-auto flex flex-nowrap p-5 flex-col md:flex-row md:flex-nowrap items-center ml-16">
                        <div class="border-b-2 border-gray-300 pb-2">
                    
                        <a class="m-10 hover:text-gray-900" href="#">First Link</a>
                        
                        <a class="m-10 hover:text-gray-900" href="#">Second Link</a>
                        
                        <a class="m-10 hover:text-gray-900" href="#">Third Link</a>
                 
                    </div>
                    </div>
                  </header> -->
                  <section class="text-gray-600 body-font">
                    <div class="container pl-10">
                      <div class="flex mx-auto flex-wrap mb5">
                        <a href="tasklist.html" class="sm:px-6 py-3 w-1/2 sm:w-auto justify-center sm:justify-start border-b-2 title-font font-medium bg-gray-100 inline-flex items-center leading-none border-indigo-500 text-indigo-500 tracking-wider rounded-t">
                          <!-- <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-5 h-5 mr-3" viewBox="0 0 24 24">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                          </svg>-->First Link 
                        </a>
                        <a href="taskandgantt.html" class="sm:px-6 py-3 w-1/2 sm:w-auto justify-center sm:justify-start border-b-2 title-font font-medium inline-flex items-center leading-none border-gray-200 hover:text-gray-900 tracking-wider">
                          <!-- <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-5 h-5 mr-3" viewBox="0 0 24 24">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                          </svg>-->Second Link 
                        </a>
                        <a href="comment.html" class="sm:px-6 py-3 w-1/2 sm:w-auto justify-center sm:justify-start border-b-2 title-font font-medium inline-flex items-center leading-none border-gray-200 hover:text-gray-900 tracking-wider">
                          <!-- <svg fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-5 h-5 mr-3" viewBox="0 0 24 24">
                            <circle cx="12" cy="5" r="3"></circle>
                            <path d="M12 22V8M5 12H2a10 10 0 0020 0h-3"></path>
                          </svg> -->Third Link
                        </a>
                      </div>
                    </div>
                </section>


<!-- Start Gantt Chart -->
<div class="font-medium text-xl ml-6 mt-10">Milestone</div>

<div id="see_chart" data-project-id="{{project.id}}" class="bg-indigo-400 w-fit rounded-md p-2 ml-9 text-white hover:bg-indigo-300 shadow">see chart</div><br>
             
<div class="data-container" style="display:none;">
            <div id="chart_div"></div>

</div>

            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
            
            <script>
                $(document).ready(function() {
                  $('#see_chart').click((e) => {
                    $('.data-container').toggle();
                      const id = e.target.getAttribute('data-project-id');
              
                      google.charts.load('current', {'packages':['gantt']});
                      google.charts.setOnLoadCallback(drawChart);
              
                      function drawChart() {
                        var data = new google.visualization.DataTable();
                        data.addColumn('string', 'Task ID');
                        data.addColumn('string', 'Task Name');
                        data.addColumn('date', 'Start Date');
                        data.addColumn('date', 'End Date');
                        data.addColumn('number', 'Duration');
                        data.addColumn('number', 'Percent Complete');
                        data.addColumn('string', 'Dependencies');
              
                        // get data from server
                        $.ajax({
                            url: `/get-tasks/${id}/`,
                            dataType: 'json',
                            success: function(jsonData) {
                                console.log(jsonData)
                                // format data for chart
                                var rows = [];
                                $.each(jsonData, function(i, task) {
                                    rows.push([
                                    task.Task_ID,
                                    task.Task_Name,
                                    new Date(task.Start_Date),
                                    new Date(task.End_Date),
                                    task.Duration,
                                    task.Percent_Complete,
                                    null,
                                    ]);
                                });
                                data.addRows(rows);
              
                                // set chart options
                                var options = {
                                    height: 275,
          
                                };
              
                                // create and draw chart
                                var chart = new google.visualization.Gantt(document.getElementById('chart_div'));
                                chart.draw(data, options);
                            },
                            error: function(jqXHR, textStatus, errorThrown) {
                                console.log(textStatus, errorThrown);
                            }
                        });
                      }
                  });
                });
              </script>


<!-- End Gantt Chart -->
             
        <section class="text-gray-600 body-font overflow-hidden">
          <p class="mt-10 text-3xl text-gray-600 ml-6">Task</p>
            <div class="container px-5 py-24 mx-auto w-screen">
         
              <div class="-my-8 divide-y-2 divide-gray-100">
                {% if tasks %}
                <a class="hover:text-gray-900 " href="#">Filter</a>
                {% for task in tasks %}
                <div class="py-8 flex flex-wrap md:flex-nowrap">
                  <div class="md:w-64 md:mb-0 mb-6 flex-shrink-0 flex flex-col">
                    <span class="font-semibold title-font text-gray-700">Completed: {{ task.percent_complete }}%</span>
                    <span class="mt-1 text-gray-500 text-sm">Start: {{ task.start_date }}</span>
                    <span class="mt-1 text-gray-500 text-sm">End: {{ task.end_date }}</span>
                  </div>
                    <div class="md:flex-grow">
                    <a href="{% url 'task_details' project_id=project.id task_id=task.id%}"> <h2 class="hover:text-gray-400 text-2xl font-medium text-gray-900 title-font mb-2">Title: {{ task.title }}</h2></a>
                    <!--<p class="leading-relaxed">Glossier echo park pug, church-key sartorial biodiesel vexillologist pop-up snackwave ramps cornhole. Marfa 3 wolf moon party messenger bag selfies, poke vaporware kombucha lumbersexual pork belly polaroid hoodie portland craft beer.</p>
                    -->
                    <div class="text-gray-700 inline-flex items-center">Description: {{ task.description }}
                      </div>


                        
               
                    <div class="text-gray-700">Assignee:
                      {% if task.assignee %}
                      {{ task.assignee }}
                      {% else %}
                      No assignee. 
                      {% endif %}
                    </div>
                   
                    </div>
                   
                    <div>
                    <div class="flex flex-col-reverse">
                     
                      
                      <div class="justify-center p-2 font-bold text-2xl">
                    <a href="{% url 'sub_task_list' project_id=project.id task_id=task.id %}" class="mr-10 rounded-md bg-gray-200 px-2 py-1 hover:bg-indigo-200 text-sm hover:bg-gray-300">Sub Task ></a>
                  </div>
                    </div>
                  </div>
                  
                </div>
            

               
                {% endfor %}

                {% else %}
                <p>No Tasks found.</p>
                {% endif %}

                {% if is_team_member or is_team_leader %}
                <div>
                    <a href="{% url 'create_task' project_id=project.id %}"><button class="hover:bg-indigo-300 rounded-md bg-indigo-200 m-4 px-8 py-2 font-medium">+ Create Task</button></a>
            
                </div>
                {% endif %}


              </div>
            </div>
          </section>
   
{% endblock %}